<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

  <title>IVUL Publications</title>
  <style>
    .paper-item img {
      width: 25%;
    }

    /* hide the thumbnail in small screens */
    @media screen and (max-width:768px) {
      .paper-item img {
        display: none;
      }
    }
  </style>
  <script src="biblib.js"></script>
</head>

<body>
  <!-- Papers -->
  <div class="container">
    <div class="row">
      <div class="col">
        <ul id="paperList" class="list-unstyled"></ul>
      </div>
    </div>
  </div>
  <!-- Abstract modal -->
  <div class="modal fade" id="paperAbstract" tabindex="-1" role="dialog" aria-labelledby="paperAbstractTitle"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="paperAbstractTitle"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Citation modal -->
  <div class="modal fade" id="paperBibTex" tabindex="-1" role="dialog" aria-labelledby="paperBibTexTitle"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="paperBibTexTitle">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <pre><code></code></pre>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
  <script>
    "use strict";
    // const full_venue = { 
    //     'CVPR': 'IEEE Conference on Computer Vision and Pattern Recognition',
    // };
    // const biblib = {
    //   Muller_2019_CVPRW_LACFN: {
    //     title: 'Learning a Controller Fusion Network',
    //     authors: ['Matthias Muller*', 'Guohao Li*', 'Bernard Ghanem'],
    //     venue: 'CVPRW',
    //     theme: 3,
    //     distinctions: ['Oral', 'Best Paper Award'],
    //     abstract: 'Example.',
    //     year: 2019,
    //     thumbnail: '1mYuiwV7hsiC9ElORbNf0JA5ArxcZVm5w',  # Google Drive ID or raw URL
    //     links: {
    //       paper: '{FileId}',  # Google Drive ID or raw URL
    //       code: 'https://github.com/example/{RepoName}',  # Google Drive ID or raw URL
    //     },
    //   },
    // };
    $('#paperAbstract').on('show.bs.modal', function (event) {
      const modal = $(this);
      const bibkey = $(event.relatedTarget).data('bibkey');
      const bibitem = biblib[bibkey];
      modal.find('.modal-title').text(bibitem.title);
      modal.find('.modal-body').text(bibitem.abstract);
    });
    $('#paperBibTex').on('show.bs.modal', function (event) {
      const modal = $(this);
      const bibkey = $(event.relatedTarget).data('bibkey');
      const bibitem = biblib[bibkey];
      const bibtex = `@paper{${bibkey},
        author = {${bibitem.authors.join(" and ")}},
        title = {${bibitem.title}},
        conference = {${full_venue[bibitem.venue]}},
        year = {${bibitem.year}},\n}`.replace(/\n +/g, '\n  ');
      modal.find('.modal-title').text(bibitem.title);
      modal.find('.modal-body').find('code').text(bibtex);
    });
    function getDriveURL(drive_url, image = false) {
      if (drive_url.includes('/')) {
        return drive_url;
      } else if (!drive_url) {
        drive_url = '1mYuiwV7hsiC9ElORbNf0JA5ArxcZVm5w';  // placeholder IVUL logo
      }
      const postfix = image ? `thumbnail?id=${drive_url}` : `file/d/${drive_url}/view?usp=drivesdk`;
      return `https://drive.google.com/a/kaust.edu.sa/${postfix}`;
    }
    function toMedia(element, image_url = '', image_alt = '') {
      // takes an HTML element and convert it into a Bootstrap media object with a thumbnail
      element.addClass('media py-1').append([
        $('<img>').attr({
          src: getDriveURL(image_url, true),
          alt: image_alt,
          class: 'align-self-center mr-0',
        }),
        $('<div>').attr('class', 'media-body'),
      ]);
      return element.children().last();
    }
    function toCard(element, title = '', subtitle = '') {
      // takes an HTML element and convert it into a Bootstrap card with footer
      const card_body = $('<div>').attr('class', 'card-body').append([
        $('<h5>').attr('class', 'card-title').text(title),
        $('<h6>').attr('class', 'card-subtitle mb-2 text-muted').text(subtitle),
        $('<p>').attr('class', 'card-text'),
      ]);
      const card_footer = $('<div>').attr('class', 'card-footer');
      element.addClass('card').append(card_body, card_footer);
      return { body: card_body.children().last(), footer: card_footer };
    }
    function createButton(text, style = 'dark', link = null, target = null) {
      const button = $('<button>').attr({
        type: 'button',
        class: `btn btn-${style} btn-sm m-1`,
      }).text(text);
      if (link) {
        return $('<a>').attr({ href: link, target: target }).append(button);
      }
      return button;
    }
    function createItem(bibkey) {
      const bibitem = biblib[bibkey];
      const authors = bibitem.authors.join(', ');
      const distinctions = bibitem.distinctions.length ?
        ('[' + bibitem.distinctions.join('] [') + ']') : '';
      const li = $('<li>').attr('class', 'paper-item');
      const media = toMedia(li, bibitem.thumbnail, bibitem.title);
      const card = toCard(media, bibitem.title, authors);
      card.body.append([
        createButton(`Theme ${bibitem.theme}`, 'secondary'),
        $('<i>').text(` Published in ${bibitem.venue} ${bibitem.year} `),
        $('<b>').text(distinctions),
      ]);
      card.footer.append(createButton('Abstract', 'outline-primary').attr({
        'data-toggle': 'modal',
        'data-target': '#paperAbstract',
        'data-bibkey': bibkey,
      }));
      card.footer.append(createButton('Paper', `outline-success`, getDriveURL(bibitem.links['paper']), '_blank'));
      for (let key in bibitem.links) {
        if (key === 'paper') {
          continue;
        }
        const link = getDriveURL(bibitem.links[key]);
        const button = createButton(key, `outline-dark`, link, '_blank');
        card.footer.append(button);
      }
      card.footer.append(createButton('Cite', 'outline-danger').attr({
        'data-toggle': 'modal',
        'data-target': '#paperBibTex',
        'data-bibkey': bibkey,
      }));
      return li;
    }
  </script>
  <script>
    // https://www.sitepoint.com/get-url-parameters-with-javascript/
    const params = new URLSearchParams(window.location.search);
    const p_authors = params.getAll('author');
    const p_themes = params.getAll('theme');
    const p_venues = params.getAll('venue');
    const p_years = params.getAll('year');

    var filtered = [];
    for (let bibkey in biblib) {
      let bibitem = biblib[bibkey];
      if (p_years.length) {
        if (!p_years.find((p) => bibitem.year == p)) {
          continue;
        }
      }
      if (p_themes.length) {
        if (!p_themes.find((p) => bibitem.theme == p)) {
          continue;
        }
      }
      if (p_venues.length) {
        let venue = bibitem.venue.toLowerCase();
        if (!p_venues.find((p) => venue === p.toLowerCase())) {
          continue;
        }
      }
      if (p_authors.length) {
        let authors = bibitem.authors.join('|').toLowerCase();
        if (!p_authors.find((p) => authors.includes(p.toLowerCase()))) {
          continue;
        }
      }
      let sort_key = bibitem.year.toString() + bibitem.venue + bibitem.authors[0];
      filtered.push([bibkey, sort_key]);
    }
    filtered.sort((a, b) => (a[1] < b[1]) ? 1 : -1);
    const paper_list = $('#paperList');
    for (let pair of filtered) {
      paper_list.append(createItem(pair[0]));
    }
  </script>
</body>

</html>